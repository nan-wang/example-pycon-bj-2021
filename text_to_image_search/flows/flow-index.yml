jtype: Flow                                       # We configure the index flow here that is used for indexing images and captions
version: '1'                                      # yml version
with:                                             # Parameters for the flow are defined after with
  prefetch: 10                                    # Number of prefetched requests from the client
  port_expose: $JINA_PORT                         # Port defined in environment variable
  workspace: $JINA_WORKSPACE                      # Workspace folder
pods:                                             # Now, we define the pods that are used
  - name: image_loader                            # The first executor is an image loader that filters only image documents
    uses: ImageReader                             # Type of the executor
    py_modules: 'executors.py'              # The python file where the executor is implemented
  - name: image_encoder                           # After the images are read, compute their embedding in the encoder
    uses: 'jinahub+docker://CLIPImageEncoder/v0.3'     # The type of the executor - here, we use a hub executor from the jinahub in the form of a docker container
    volumes: $HOME/.cache/huggingface:/root/.cache/huggingface  # Mount a volume into the executor
    timeout_ready: 600000                         # Set a timeout for the executor
  - name: image_indexer                           # Executor that stores image embeddings
    uses: 'jinahub://PQLiteIndexer/v0.1.3'
    install_requirements: True
    uses_with:
      startup_sync: False
      dim: 512
      metric: 'cosine'